name: Notify on PR Merge

on:
    pull_request:
        branches:
            - main

jobs:
    notify:
        if: github.event.pull_request.merged == true
        runs-on: ubuntu-latest

        steps:
            - name: Enviar notificação para Slack
              run: |
                  PR_TITLE="${{ github.event.pull_request.title }}"
                  PR_NUMBER="${{ github.event.pull_request.number }}"
                  PR_AUTHOR="${{ github.event.pull_request.user.login }}"
                  PR_BODY="${{ github.event.pull_request.body }}"

                  PAYLOAD=$(jq -n \
                    --arg title "$PR_TITLE" \
                    --arg number "$PR_NUMBER" \
                    --arg author "$PR_AUTHOR" \
                    --arg body "$PR_BODY" \
                    '{
                        text: "*PR #" + $number + " merged!*",
                        attachments: [
                          {
                            color: "#36a64f",
                            fields: [
                              { title: "Title", value: $title, short: false },
                              { title: "Author", value: $author, short: true },
                              { title: "Description", value: $body, short: false }
                            ]
                          }
                        ]
                      }')

                  curl -X POST \
                    -H 'Content-type: application/json' \
                    --data "$PAYLOAD" \
                    ${{ secrets.SLACK_WEBHOOK_URL }}
